<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Compatibility Final Test - Task 8.1</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="geometric-theme-system.css">
    <link rel="stylesheet" href="responsive-geometric-enhancements.css">
    <link rel="stylesheet" href="mobile-geometric-enhancements.css">
    <style>
        .test-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--geometric-gradient-primary);
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 10000;
            font-weight: bold;
        }
        
        .test-content {
            margin-top: 60px;
            padding: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid var(--geometric-cyan);
            border-radius: var(--geometric-border-radius);
            background: rgba(10, 10, 10, 0.8);
        }
        
        .test-title {
            color: var(--geometric-cyan);
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        .test-result.pass {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #22c55e;
        }
        
        .test-result.fail {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }
        
        .test-result.warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #f59e0b;
            color: #f59e0b;
        }
        
        .device-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(10, 10, 10, 0.9);
            color: var(--geometric-cyan);
            padding: 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            z-index: 10000;
            border: 1px solid var(--geometric-cyan);
            max-width: 200px;
        }
        
        .summary-card {
            background: var(--geometric-gradient-primary);
            color: white;
            padding: 20px;
            border-radius: var(--geometric-border-radius);
            margin: 20px 0;
            text-align: center;
        }
        
        .summary-score {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .test-button {
            background: var(--geometric-gradient-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--geometric-border-radius);
            cursor: pointer;
            margin: 5px;
            min-height: 44px;
            font-weight: 600;
        }
        
        .test-button:active {
            transform: scale(0.95);
        }
        
        @media (max-width: 480px) {
            .test-content {
                padding: 10px;
            }
            
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .device-info {
                position: relative;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="test-header">
        üì± Mobile Compatibility Test - Task 8.1 Implementation
    </div>
    
    <div class="device-info" id="device-info">
        <div><strong>Device Info:</strong></div>
        <div>Screen: <span id="screen-size">-</span></div>
        <div>Viewport: <span id="viewport-size">-</span></div>
        <div>DPR: <span id="device-pixel-ratio">-</span></div>
        <div>Touch: <span id="touch-support">-</span></div>
        <div>Breakpoint: <span id="current-breakpoint">-</span></div>
    </div>

    <div class="test-content">
        <h1 class="geometric-text-gradient">Task 8.1: Mobile Compatibility Validation</h1>
        
        <div class="summary-card" id="summary-card">
            <h2>Test Summary</h2>
            <div class="summary-score" id="summary-score">Running Tests...</div>
            <div id="summary-details">Please wait while we validate mobile compatibility...</div>
        </div>

        <!-- Responsive Design Test -->
        <div class="test-section">
            <h2 class="test-title">üìê Responsive Design Implementation</h2>
            <div id="responsive-results"></div>
            
            <div class="test-grid">
                <div class="geometric-card">
                    <h3>Mobile Layout Test</h3>
                    <p class="mobile-only">‚úÖ Mobile layout active</p>
                    <p class="tablet-only">‚ùå Should be hidden on mobile</p>
                    <p class="desktop-only">‚ùå Should be hidden on mobile</p>
                </div>
                <div class="geometric-card">
                    <h3>Tablet Layout Test</h3>
                    <p class="mobile-only">‚ùå Should be hidden on tablet</p>
                    <p class="tablet-only">‚úÖ Tablet layout active</p>
                    <p class="desktop-only">‚ùå Should be hidden on tablet</p>
                </div>
                <div class="geometric-card">
                    <h3>Desktop Layout Test</h3>
                    <p class="mobile-only">‚ùå Should be hidden on desktop</p>
                    <p class="tablet-only">‚ùå Should be hidden on desktop</p>
                    <p class="desktop-only">‚úÖ Desktop layout active</p>
                </div>
            </div>
        </div>

        <!-- Touch Target Test -->
        <div class="test-section">
            <h2 class="test-title">üëÜ Touch Target Validation</h2>
            <div id="touch-target-results"></div>
            
            <div class="test-grid">
                <button type="button" class="test-button" data-size="small" style="padding: 8px 16px;">Small Button (32px)</button>
                <button type="button" class="test-button" data-size="adequate" style="padding: 12px 24px;">Adequate Button (44px)</button>
                <button type="button" class="test-button" data-size="recommended" style="padding: 16px 32px;">Recommended Button (48px)</button>
            </div>
        </div>

        <!-- Control Panel Mobile Test -->
        <div class="test-section">
            <h2 class="test-title">üéõÔ∏è Control Panel Mobile Behavior</h2>
            <div id="control-panel-results"></div>
            
            <div class="control-panel" style="position: relative; margin: 20px 0;">
                <div class="control-group">
                    <div class="control">
                        <label for="test-color">Test Color</label>
                        <input type="color" id="test-color" value="#00D4FF">
                    </div>
                    <div class="control">
                        <label for="test-range">Test Range</label>
                        <input type="range" id="test-range" min="0" max="100" value="50">
                    </div>
                </div>
                <button type="button" class="geometric-button">Test Control</button>
            </div>
        </div>

        <!-- Geometric Theme Test -->
        <div class="test-section">
            <h2 class="test-title">üé® Geometric Theme Mobile Integration</h2>
            <div id="geometric-theme-results"></div>
            
            <div class="test-grid">
                <div class="geometric-card geometric-interactive">
                    <h3>Interactive Card</h3>
                    <p>Tap to test mobile interactions</p>
                </div>
                <div class="geometric-card geometric-interactive flowing">
                    <h3>Flowing Gradient</h3>
                    <p>Animated gradient background</p>
                </div>
                <div class="geometric-card geometric-interactive morphing">
                    <h3>Shape Morphing</h3>
                    <p>Geometric shape transitions</p>
                </div>
            </div>
        </div>

        <!-- Modal Test -->
        <div class="test-section">
            <h2 class="test-title">ü™ü Modal Mobile Responsiveness</h2>
            <div id="modal-results"></div>
            
            <button type="button" onclick="showTestModal()" class="test-button">Test Mobile Modal</button>
        </div>

        <!-- Performance Test -->
        <div class="test-section">
            <h2 class="test-title">‚ö° Mobile Performance</h2>
            <div id="performance-results"></div>
            
            <button type="button" onclick="runPerformanceTest()" class="test-button">Run Performance Test</button>
            
            <div id="performance-metrics" style="margin-top: 15px;">
                <div>FPS: <span id="fps-counter">-</span></div>
                <div>Memory: <span id="memory-usage">-</span></div>
                <div>Paint Time: <span id="paint-time">-</span></div>
            </div>
        </div>

        <!-- Accessibility Test -->
        <div class="test-section">
            <h2 class="test-title">‚ôø Mobile Accessibility</h2>
            <div id="accessibility-results"></div>
            
            <div class="test-grid">
                <button type="button" class="test-button" style="min-height: 44px;">iOS Minimum (44px)</button>
                <button type="button" class="test-button" style="min-height: 48px;">Android Recommended (48px)</button>
                <input type="text" placeholder="Accessible input" style="min-height: 44px; padding: 12px; width: 100%; box-sizing: border-box;">
            </div>
        </div>
    </div>

    <!-- Test Modal -->
    <div id="test-modal" class="auth-modal modal-hidden">
        <div class="auth-modal-content">
            <button type="button" onclick="hideTestModal()" class="close-button">&times;</button>
            <div class="auth-header">
                <h2>Mobile Modal Test</h2>
                <p>Testing modal behavior on mobile devices</p>
            </div>
            <div class="form-group">
                <label for="modal-test-input">Test Input</label>
                <input type="text" id="modal-test-input" placeholder="Test mobile modal input">
            </div>
            <div class="form-actions">
                <button type="button" class="geometric-button" onclick="hideTestModal()">Close Modal</button>
            </div>
        </div>
    </div>

    <script src="responsive-geometric-manager.js"></script>
    <script src="mobile-compatibility-validator.js"></script>
    <script src="validate-mobile-compatibility.js"></script>
    
    <script>
        class Task81Validator {
            constructor() {
                this.testResults = new Map();
                this.init();
            }
            
            init() {
                this.updateDeviceInfo();
                this.runTask81Tests();
                
                // Update on resize
                window.addEventListener('resize', () => {
                    this.updateDeviceInfo();
                    this.runTask81Tests();
                });
            }
            
            updateDeviceInfo() {
                document.getElementById('screen-size').textContent = `${screen.width}x${screen.height}`;
                document.getElementById('viewport-size').textContent = `${window.innerWidth}x${window.innerHeight}`;
                document.getElementById('device-pixel-ratio').textContent = window.devicePixelRatio || 1;
                document.getElementById('touch-support').textContent = 'ontouchstart' in window ? 'Yes' : 'No';
                
                if (window.responsiveGeometricManager) {
                    document.getElementById('current-breakpoint').textContent = 
                        window.responsiveGeometricManager.getCurrentBreakpoint();
                }
            }
            
            runTask81Tests() {
                this.testResponsiveImplementation();
                this.testTouchTargetSizes();
                this.testControlPanelMobile();
                this.testGeometricThemeIntegration();
                this.testModalResponsiveness();
                this.testAccessibilityFeatures();
                this.updateSummary();
            }
            
            testResponsiveImplementation() {
                const results = [];
                
                // Test responsive manager
                results.push({
                    name: 'Responsive Manager Loaded',
                    pass: window.responsiveGeometricManager !== undefined,
                    critical: true
                });
                
                // Test breakpoint detection
                if (window.responsiveGeometricManager) {
                    const breakpoint = window.responsiveGeometricManager.getCurrentBreakpoint();
                    results.push({
                        name: 'Breakpoint Detection',
                        pass: breakpoint !== undefined,
                        critical: true
                    });
                }
                
                // Test CSS files
                const hasResponsiveCSS = Array.from(document.styleSheets).some(sheet => {
                    try {
                        return sheet.href && (
                            sheet.href.includes('responsive-geometric-enhancements.css') ||
                            sheet.href.includes('mobile-geometric-enhancements.css')
                        );
                    } catch (e) {
                        return false;
                    }
                });
                
                results.push({
                    name: 'Mobile CSS Files Loaded',
                    pass: hasResponsiveCSS,
                    critical: true
                });
                
                // Test viewport configuration
                const viewportMeta = document.querySelector('meta[name="viewport"]');
                results.push({
                    name: 'Viewport Meta Tag',
                    pass: viewportMeta && viewportMeta.content.includes('width=device-width'),
                    critical: true
                });
                
                this.renderResults('responsive-results', results);
                this.testResults.set('responsive', results);
            }
            
            testTouchTargetSizes() {
                const results = [];
                const buttons = document.querySelectorAll('.test-button[data-size]');
                
                buttons.forEach(button => {
                    const rect = button.getBoundingClientRect();
                    const size = button.dataset.size;
                    let expectedMin = 32;
                    
                    if (size === 'adequate') expectedMin = 44;
                    if (size === 'recommended') expectedMin = 48;
                    
                    results.push({
                        name: `${size} Button Touch Target`,
                        pass: rect.width >= expectedMin && rect.height >= expectedMin,
                        critical: size === 'adequate'
                    });
                });
                
                // Test all interactive elements
                const allInteractive = document.querySelectorAll('button, input, select, textarea, a[href]');
                let adequateCount = 0;
                
                allInteractive.forEach(element => {
                    if (element.offsetParent === null) return;
                    const rect = element.getBoundingClientRect();
                    if (rect.width >= 44 && rect.height >= 44) adequateCount++;
                });
                
                results.push({
                    name: 'Overall Touch Target Compliance',
                    pass: adequateCount / allInteractive.length >= 0.8,
                    critical: true
                });
                
                this.renderResults('touch-target-results', results);
                this.testResults.set('touchTargets', results);
            }
            
            testControlPanelMobile() {
                const results = [];
                const controlPanel = document.querySelector('.control-panel');
                
                if (controlPanel) {
                    const styles = getComputedStyle(controlPanel);
                    
                    // Test mobile positioning
                    if (window.innerWidth <= 480) {
                        const isMobilePositioned = styles.position === 'fixed' && 
                                                 (styles.bottom === '0px' || parseInt(styles.bottom) >= 0);
                        
                        results.push({
                            name: 'Mobile Bottom Positioning',
                            pass: isMobilePositioned,
                            critical: true
                        });
                    }
                    
                    // Test toggle button
                    const toggleButton = controlPanel.querySelector('.control-panel-toggle');
                    if (window.innerWidth <= 768) {
                        results.push({
                            name: 'Toggle Button Present',
                            pass: toggleButton !== null,
                            critical: false
                        });
                    }
                    
                    // Test input sizes
                    const inputs = controlPanel.querySelectorAll('input');
                    let adequateInputs = 0;
                    
                    inputs.forEach(input => {
                        const rect = input.getBoundingClientRect();
                        if (rect.height >= 44) adequateInputs++;
                    });
                    
                    results.push({
                        name: 'Control Input Touch Targets',
                        pass: inputs.length === 0 || adequateInputs / inputs.length >= 0.8,
                        critical: true
                    });
                } else {
                    results.push({
                        name: 'Control Panel Present',
                        pass: false,
                        critical: true
                    });
                }
                
                this.renderResults('control-panel-results', results);
                this.testResults.set('controlPanel', results);
            }
            
            testGeometricThemeIntegration() {
                const results = [];
                
                // Test CSS variables
                const rootStyles = getComputedStyle(document.documentElement);
                const geometricCyan = rootStyles.getPropertyValue('--geometric-cyan');
                const geometricPink = rootStyles.getPropertyValue('--geometric-pink');
                
                results.push({
                    name: 'Geometric Color Variables',
                    pass: geometricCyan.includes('#00D4FF') && geometricPink.includes('#FF6B6B'),
                    critical: true
                });
                
                // Test mobile-specific variables
                const mobileSpacing = rootStyles.getPropertyValue('--mobile-spacing');
                const mobileTouchTarget = rootStyles.getPropertyValue('--mobile-touch-target');
                
                results.push({
                    name: 'Mobile CSS Variables',
                    pass: mobileSpacing.trim() !== '' || mobileTouchTarget.trim() !== '',
                    critical: false
                });
                
                // Test geometric elements
                const geometricElements = document.querySelectorAll('[class*="geometric-"]');
                results.push({
                    name: 'Geometric Elements Present',
                    pass: geometricElements.length > 0,
                    critical: false
                });
                
                // Test gradient support
                const testElement = document.createElement('div');
                testElement.style.background = 'linear-gradient(45deg, #00D4FF, #FF6B6B)';
                document.body.appendChild(testElement);
                
                const gradientSupport = getComputedStyle(testElement).background.includes('gradient') ||
                                       getComputedStyle(testElement).backgroundImage.includes('gradient');
                
                results.push({
                    name: 'CSS Gradient Support',
                    pass: gradientSupport,
                    critical: false
                });
                
                document.body.removeChild(testElement);
                
                this.renderResults('geometric-theme-results', results);
                this.testResults.set('geometricTheme', results);
            }
            
            testModalResponsiveness() {
                const results = [];
                const modal = document.getElementById('test-modal');
                
                if (modal) {
                    const modalContent = modal.querySelector('.auth-modal-content');
                    
                    results.push({
                        name: 'Modal Structure Present',
                        pass: modalContent !== null,
                        critical: true
                    });
                    
                    if (modalContent) {
                        const styles = getComputedStyle(modalContent);
                        
                        // Test mobile width on small screens
                        if (window.innerWidth <= 480) {
                            const hasFullWidth = styles.width === '100%' || 
                                               styles.maxWidth === '100%' ||
                                               parseInt(styles.width) >= window.innerWidth * 0.9;
                            
                            results.push({
                                name: 'Mobile Full Width',
                                pass: hasFullWidth,
                                critical: true
                            });
                        }
                        
                        // Test overflow handling
                        results.push({
                            name: 'Overflow Handling',
                            pass: styles.overflowY === 'auto' || styles.overflowY === 'scroll',
                            critical: false
                        });
                    }
                } else {
                    results.push({
                        name: 'Test Modal Present',
                        pass: false,
                        critical: true
                    });
                }
                
                this.renderResults('modal-results', results);
                this.testResults.set('modals', results);
            }
            
            testAccessibilityFeatures() {
                const results = [];
                
                // Test reduced motion support
                const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                results.push({
                    name: 'Reduced Motion Detection',
                    pass: window.matchMedia !== undefined,
                    critical: false
                });
                
                // Test high contrast support
                const prefersHighContrast = window.matchMedia('(prefers-contrast: high)').matches;
                results.push({
                    name: 'High Contrast Detection',
                    pass: window.matchMedia !== undefined,
                    critical: false
                });
                
                // Test focus management
                const focusableElements = document.querySelectorAll('button, input, select, textarea, a[href]');
                results.push({
                    name: 'Focusable Elements Present',
                    pass: focusableElements.length > 0,
                    critical: false
                });
                
                // Test semantic HTML
                const semanticElements = document.querySelectorAll('main, section, article, nav, header, footer');
                results.push({
                    name: 'Semantic HTML Elements',
                    pass: semanticElements.length > 0,
                    critical: false
                });
                
                this.renderResults('accessibility-results', results);
                this.testResults.set('accessibility', results);
            }
            
            renderResults(containerId, results) {
                const container = document.getElementById(containerId);
                container.innerHTML = results.map(result => `
                    <div class="test-result ${result.pass ? 'pass' : (result.critical ? 'fail' : 'warning')}">
                        <strong>${result.name}:</strong> ${result.pass ? '‚úÖ Pass' : (result.critical ? '‚ùå Fail' : '‚ö†Ô∏è Warning')}
                    </div>
                `).join('');
            }
            
            updateSummary() {
                let totalTests = 0;
                let passedTests = 0;
                let criticalTests = 0;
                let passedCriticalTests = 0;
                
                this.testResults.forEach(categoryResults => {
                    categoryResults.forEach(result => {
                        totalTests++;
                        if (result.pass) passedTests++;
                        if (result.critical) {
                            criticalTests++;
                            if (result.pass) passedCriticalTests++;
                        }
                    });
                });
                
                const passRate = Math.round((passedTests / totalTests) * 100);
                const criticalPassRate = criticalTests > 0 ? Math.round((passedCriticalTests / criticalTests) * 100) : 100;
                
                let grade;
                if (criticalPassRate === 100 && passRate >= 95) grade = 'A+';
                else if (criticalPassRate >= 90 && passRate >= 90) grade = 'A';
                else if (criticalPassRate >= 80 && passRate >= 85) grade = 'B+';
                else if (criticalPassRate >= 70 && passRate >= 80) grade = 'B';
                else if (criticalPassRate >= 60 && passRate >= 75) grade = 'C+';
                else if (criticalPassRate >= 50 && passRate >= 70) grade = 'C';
                else grade = 'D';
                
                document.getElementById('summary-score').textContent = `${grade} (${passRate}%)`;
                document.getElementById('summary-details').innerHTML = `
                    <div>‚úÖ Passed: ${passedTests}/${totalTests} tests</div>
                    <div>üéØ Critical: ${passedCriticalTests}/${criticalTests} passed</div>
                    <div>üì± Mobile compatibility: ${grade}</div>
                `;
                
                // Update summary card color based on grade
                const summaryCard = document.getElementById('summary-card');
                if (grade.startsWith('A')) {
                    summaryCard.style.background = 'linear-gradient(45deg, #22c55e, #16a34a)';
                } else if (grade.startsWith('B')) {
                    summaryCard.style.background = 'linear-gradient(45deg, #3b82f6, #1d4ed8)';
                } else if (grade.startsWith('C')) {
                    summaryCard.style.background = 'linear-gradient(45deg, #f59e0b, #f97316)';
                } else {
                    summaryCard.style.background = 'linear-gradient(45deg, #ef4444, #dc2626)';
                }
            }
        }
        
        // Test utilities
        function showTestModal() {
            document.getElementById('test-modal').classList.remove('modal-hidden');
        }
        
        function hideTestModal() {
            document.getElementById('test-modal').classList.add('modal-hidden');
        }
        
        function runPerformanceTest() {
            // FPS Test
            let frames = 0;
            const startTime = performance.now();
            
            function countFrames() {
                frames++;
                const currentTime = performance.now();
                
                if (currentTime - startTime >= 1000) {
                    document.getElementById('fps-counter').textContent = `${frames} FPS`;
                    return;
                }
                
                requestAnimationFrame(countFrames);
            }
            
            requestAnimationFrame(countFrames);
            
            // Memory Test
            if (performance.memory) {
                const memoryMB = Math.round(performance.memory.usedJSHeapSize / 1048576);
                document.getElementById('memory-usage').textContent = `${memoryMB} MB`;
            } else {
                document.getElementById('memory-usage').textContent = 'Not available';
            }
            
            // Paint Time Test
            if (performance.getEntriesByType) {
                const paintEntries = performance.getEntriesByType('paint');
                const firstPaint = paintEntries.find(entry => entry.name === 'first-paint');
                
                if (firstPaint) {
                    document.getElementById('paint-time').textContent = `${Math.round(firstPaint.startTime)}ms`;
                } else {
                    document.getElementById('paint-time').textContent = 'Not available';
                }
            }
        }
        
        // Initialize validator
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                window.task81Validator = new Task81Validator();
            }, 500);
        });
        
        console.log('üß™ Task 8.1 Mobile Compatibility Test initialized');
        console.log('üì± Testing geometric theme mobile compatibility implementation');
    </script>
</body>
</html>